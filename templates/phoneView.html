<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Page</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.3/socket.io.js"
        integrity="sha512-jDUVpk2awjMnyrpY2xZguylQVRDeS9kRBImn0M3NJaZzowzUpKr6i62ynwPG0vNS1+NsTk4ji+iznbc5m0ZCKQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="/static/css/phoneView.css">
</head>

<body>
    <a href="/" style="color: white; text-decoration: none; margin: 20px;">Go back!</a>
    <div class="buttons">
        <button class="btn0">A</button>
        <button class="btn1">B</button>
        <button class="btn2">C</button>
        <button class="btn3">D</button>
        <div class="checkAnswer">
            <p class="answerResultLabel"></p>
        </div>
    </div>
</body>

<script>
    var socket = io.connect("http://" + document.domain + ":" + location.port);
    let buttonsDiv = document.querySelector(".buttons");
    var globalQuestionsData;

    var uid = "{{ id }}";
    localStorage.setItem('uid', uid); // każdy urzytkownik dostaje unikalne id generwane przez serwerb

    //Po otrzymaniu od widoku komputera nowego pytania wykonuje się ta funckaj
    socket.on('nextQuestion', function (data) {
        globalQuestionsData = data;
        for (let i = 0; i < 4; i++) {
            let actualButton = document.querySelector(`.btn${i}`);
            actualButton.classList.remove(actualButton.classList.contains("correct") ? "correct" : "incorrect");

            actualButton.innerText = data["base"][data["questionId"]]["answers"][i] //Ta pętla przechodzi przez pytania które dostajemy z bazy
        }
    });

    if (buttonsDiv) {
        var buttons = buttonsDiv.querySelectorAll("button");

        buttons.forEach(function(btn) {
            btn.addEventListener('click', (e) => {
                // tutaj będzie pokazywało się czy zaznaczyliśmy dobrą odpowiedź
                if (e.target.innerText == globalQuestionsData["base"][globalQuestionsData["questionId"]]["correct"]) {
                    e.target.classList.add("correct");
                } else {
                    e.target.classList.add("incorrect");
                }
                socket.emit('answer', { 'answer': e.target.innerText }); // wysyłanie wybranej odpowiedzi do serwera
            });
        });
    }

</script>
</html>
